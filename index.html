<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>عرض فيديو TikTok للتحميل</title>
</head>
<body>
  <h2>عرض فيديو TikTok مع زر تحميل</h2>

  <video id="videoPlayer" width="480" controls>
    <source id="videoSource" src="" type="video/mp4" />
    متصفحك لا يدعم عرض الفيديو.
  </video>

  <br />
  <a id="downloadBtn" href="#" download style="display:none; margin-top:10px; font-size:18px;">⬇ تحميل الفيديو</a>

  <br /><br />
  <input type="text" id="inputUrl" placeholder="أدخل رابط فيديو TikTok هنا" style="width: 400px;" />
  <button id="btnFetch">احصل على الفيديو</button>

  <script>
    const workerApiUrl = 'https://watermarktt.whredone2025.workers.dev/';

    const videoPlayer = document.getElementById('videoPlayer');
    const videoSource = document.getElementById('videoSource');
    const downloadBtn = document.getElementById('downloadBtn');

    document.getElementById('btnFetch').addEventListener('click', async () => {
      const url = document.getElementById('inputUrl').value.trim();
      if (!url) {
        alert('يرجى إدخال رابط صحيح');
        return;
      }

      try {
        const response = await fetch(workerApiUrl + '?url=' + encodeURIComponent(url));
        const data = await response.json();

        if (data.status === 'ok' && data.extracted.type === 'video') {
          const videoUrl = data.downloadUrl;
          videoSource.src = videoUrl;
          videoPlayer.load();
          videoPlayer.style.display = 'block';

          downloadBtn.href = videoUrl;
          downloadBtn.style.display = 'inline-block';
        } else {
          alert('خطأ: الفيديو غير متوفر أو الرابط غير صالح');
          videoPlayer.style.display = 'none';
          downloadBtn.style.display = 'none';
        }
      } catch (err) {
        alert('خطأ في الاتصال: ' + err.message);
        videoPlayer.style.display = 'none';
        downloadBtn.style.display = 'none';
      }
    });
  </script>
</body>
</html>
